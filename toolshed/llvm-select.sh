#!/bin/bash

# derived from https://gist.github.com/junkdog/70231d6953592cd6f27def59fe19e50d

LLVM_VERSION=${1}

setup_llvm_alternatives()
{
    local version=${1}
    local priority=${2}
    local group=${3}
    local members=${4}
    local path=${5}
    local cmdln

    cmdln="--verbose --install ${path}${group} ${group} ${path}${group}-${version} ${priority}"
    for member in ${members}; do
        cmdln="${cmdln} --slave ${path}${member} ${member} ${path}${member}-${version}"
    done
    update-alternatives ${cmdln}
}

LLVM_ALTERNATIVES_PRI=${2}
LLVM_ALTERNATIVES_PATH="/usr/bin/"

# setup llvm-config group
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG=""
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-addr2line"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-ar"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-as"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-bcanalyzer"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-bitcode-strip"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-cat"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-cfi-verify"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-cov"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-c-test"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-cvtres"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-cxxdump"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-cxxfilt"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-cxxmap"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-debuginfod"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-debuginfod-find"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-diff"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-dis"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-dlltool"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-dwarfdump"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-dwarfutil"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-dwp"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-exegesis"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-extract"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-gsymutil"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-ifs"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-install-name-tool"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-jitlink"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-jitlink-executor"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-lib"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-libtool-darwin"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-link"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-lipo"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-lto"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-lto2"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-mc"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-mca"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-ml"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-modextract"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-mt"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-nm"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-objcopy"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-objdump"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-omp-device-info"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-opt-report"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-otool"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-pdbutil"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-PerfectShuffle"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-profdata"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-profgen"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-ranlib"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-rc"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-readelf"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-readobj"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-reduce"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-remark-size-diff"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-rtdyld"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-sim"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-size"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-split"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-stress"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-strings"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-strip"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-symbolizer"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-tapi-diff"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-tblgen"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-tli-checker"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-undname"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-windres"
LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG="${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG} llvm-xray"

setup_llvm_alternatives "${LLVM_VERSION}" "${LLVM_ALTERNATIVES_PRI}" "llvm-config" "${LLVM_ALTERNATIVES_GROUP_LLVM_CONFIG}" "${LLVM_ALTERNATIVES_PATH}"

# setup clang group
LLVM_ALTERNATIVES_GROUP_CLANG=""
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} analyze-build"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} asan_symbolize"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} bugpoint"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} c-index-test"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} clang++"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} clang-apply-replacements"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} clang-change-namespace"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} clang-check"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} clang-cl"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} clang-cpp"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} clangd"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} clang-doc"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} clang-extdef-mapping"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} clang-format"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} clang-format-diff"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} clang-include-fixer"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} clang-linker-wrapper"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} clang-move"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} clang-nvlink-wrapper"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} clang-offload-bundler"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} clang-offload-packager"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} clang-offload-wrapper"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} clang-pseudo"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} clang-query"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} clang-refactor"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} clang-rename"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} clang-reorder-fields"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} clang-repl"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} clang-scan-deps"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} clang-tidy"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} count"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} diagtool"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} dsymutil"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} FileCheck"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} find-all-symbols"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} git-clang-format"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} hmaptool"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} hwasan_symbolize"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} intercept-build"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} ld64.lld"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} ld.lld"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} llc"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} lld"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} lldb"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} lldb-argdumper"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} lldb-instr"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} lldb-server"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} lldb-vscode"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} lld-link"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} lli"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} lli-child-target"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} modularize"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} not"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} obj2yaml"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} opt"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} pp-trace"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} run-clang-tidy"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} sancov"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} sanstats"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} scan-build"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} scan-build-py"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} scan-view"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} split-file"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} UnicodeNameMappingGenerator"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} verify-uselistorder"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} wasm-ld"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} yaml2obj"
LLVM_ALTERNATIVES_GROUP_CLANG="${LLVM_ALTERNATIVES_GROUP_CLANG} yaml-bench"

setup_llvm_alternatives "${LLVM_VERSION}" "${LLVM_ALTERNATIVES_PRI}" "clang" "${LLVM_ALTERNATIVES_GROUP_CLANG}" "${LLVM_ALTERNATIVES_PATH}"
